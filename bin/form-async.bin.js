var formasync={init:function(){$("form.async:not(.form-initiated) *.form-success-show").hide(),$("form.async:not(.form-initiated) *.form-fail-show").hide(),$("form.async:not(.form-initiated) *.form-loading-show").hide(),$("form.async:not(.form-initiated) *.form-initial-show").show(),$("form.async:not(.form-initiated) *.form-success-hide").show(),$("form.async:not(.form-initiated) *.form-fail-hide").show(),$("form.async:not(.form-initiated) *.form-loading-hide").show(),$("form.async:not(.form-initiated) *.form-initial-hide").hide(),$("form.async:not(.form-initiated)").addClass("form-initiated"),$(document).off("submit","form.async",formasync.submitCallback),$(document).on("submit","form.async",formasync.submitCallback)},eventStore:[],on:function(i,s,a){formasync.eventStore[i+"_"+s]=a},submitCallback:function(i){i.preventDefault();var s=$(this);s.get(0).actualRequest&&s.get(0).actualRequest.abort();var a=s.attr("action"),o=s.attr("method").toUpperCase(),t=s.serialize();formasync.statusToLoading(s),s.get(0).actualRequest=$.ajax(a,{cache:!1,type:o,data:t,success:function(i,a,o){if(parsedData=i,"string"==typeof parsedData)try{parsedData=JSON.parse(parsedData)}catch(t){parsedData={status:"fail",message:"",data:{}}}"ok"==parsedData.status?formasync.statusToSuccess(s,parsedData):formasync.statusToFail(s,parsedData),formasync.writeMessage(s,parsedData.message)},error:function(){formasync.statusToFail(s,{status:"fail",message:"",data:{}})}})},statusToLoading:function(i){i.find("*.form-success-show").hide(),i.find("*.form-fail-show").hide(),i.find("*.form-initial-show").hide(),i.find("*.form-loading-show").show(),i.find("*.form-success-hide").show(),i.find("*.form-fail-hide").show(),i.find("*.form-initial-hide").show(),i.find("*.form-loading-hide").hide(),i.hasClass("form-disableinputs")&&i.find("input").each(function(){$(this).attr("disabled","true")}),formasync.eventStore[i.attr("id")+"_loading"]&&formasync.eventStore[i.attr("id")+"_loading"](i)},statusToFail:function(i,s){i.find("*.form-success-show").hide(),i.find("*.form-loading-show").hide(),i.find("*.form-initial-show").hide(),i.find("*.form-fail-show").show(),i.find("*.form-success-hide").show(),i.find("*.form-loading-hide").show(),i.find("*.form-initial-hide").show(),i.find("*.form-fail-hide").hide(),i.hasClass("form-disableinputs")&&i.find("input").each(function(){$(this).removeAttr("disabled")}),formasync.eventStore[i.attr("id")+"_fail"]&&formasync.eventStore[i.attr("id")+"_fail"](i,s)},statusToSuccess:function(i,s){i.find("*.form-fail-show").hide(),i.find("*.form-loading-show").hide(),i.find("*.form-initial-show").hide(),i.find("*.form-success-show").show(),i.find("*.form-initial-hide").show(),i.find("*.form-fail-hide").show(),i.find("*.form-loading-hide").show(),i.find("*.form-success-hide").hide(),i.hasClass("form-disableinputs")&&i.find("input").each(function(){$(this).removeAttr("disabled")}),formasync.eventStore[i.attr("id")+"_success"]&&formasync.eventStore[i.attr("id")+"_success"](i,s)},writeMessage:function(i,s){i.find("*.form-resultmessage").each(function(){$(this).text(s)})}};$(document).ready(function(){formasync.init()});